class CustomSlider extends HTMLElement  {
	constructor() {
	super();
	this.init();
	this.renderSlider();
	}
	init(){
		if(this.querySelector('[slider-container]')){
			this.slideContainer = this.querySelector('[slider-container]');
			this.slideWidth  	= this.innerWidth | this.clientWidth;
			this.slideItems  	= this.querySelectorAll('[slider-item]');
			this.slideWrap		= this.slideContainer.dataset.slideWrap;
			this.dots 			= this.querySelector('[slide-dots]');
			this.slideSppeed 	= parseInt(this.slideContainer.dataset.slideSpeed) || 0.3;
			this.stepCount		= parseInt(this.slideContainer.dataset.slideCount) || 1;
			this.itemCount 		= this.slideItems.length - this.stepCount;
			this.itemWidth		= parseFloat(this.slideWidth) / parseFloat(this.stepCount);
			this.itemHeight		= this.clientHeight | this.innerHeight;
			this.curPos 		= 0;
			this.slideContainer.style.transition = this.slideSppeed+"s";			
			if(this.dots){
				this.renderDots();
			}
		}
	}
	renderSlider(){
	for (let i = 0; i < this.slideItems.length; i++) {
		this.slideItems[i].style.maxWidth = this.itemWidth + 'px';
		this.slideItems[i].style.minWidth = this.itemWidth + 'px';
		// this.slideItems[i].setAttribute('data-drag-target',i);
		this.slideItems[i].setAttribute('data-drag-start',0);
		this.slideItems[i].addEventListener('dragstart',function(event){
			this.setAttribute('data-drag-start',event.offsetX);
		})
		this.slideItems[i].addEventListener('dragend',function(event){
			if(event.offsetX < this.dataset.dragStart){
				if(this.closest('custom-slider').itemCount <= this.closest('custom-slider').curPos){
					if(this.closest('custom-slider').slideWrap)
						this.closest('custom-slider').curPos = 0;
					else
						return;
				}else{
						++ this.closest('custom-slider').curPos;						
				}
			}else{
				if(this.closest('custom-slider').curPos == 0){
					if(this.closest('custom-slider').slideWrap)
						this.closest('custom-slider').curPos = this.closest('custom-slider').itemCount;
					else
						return
				}else{
					-- this.closest('custom-slider').curPos;						
				}
			}
			this.closest('custom-slider').moveSlide(-999);
		})
		if(this.slideContainer.dataset.imgFullwidth && this.slideItems[i].querySelector('img')){
			this.slideItems[i].querySelector('img').style.width = "100%";
		}
	}
	}
	renderDots(){
		this.dots.innerHTML = '';
		for(let i = 0; i <= this.itemCount; i ++){
			let li = document.createElement('li');
			li.setAttribute('data-target',i);
			li.classList.add('slide-dot');
			if(i == this.curPos){
				li.classList.add('active');
			}
			li.addEventListener('click',function(){
				let slide = this.closest('custom-slider');  
				if(slide){
					slide.moveSlide(this.dataset.target);
				}	
			});
			this.dots.append(li);	
		}
	}
	moveSlide(target = -999){
	if(target != -999){
		this.curPos = target;
	}
	let position = -(this.curPos * this.itemWidth);
	this.slideContainer.style.transform = "translateX("+position+"px)";
	if(this.dots){
		this.querySelector('.slide-dot.active').classList.remove('active');
		this.querySelectorAll('.slide-dot')[this.curPos].classList.add('active');
	}
	}
}
if (!customElements.get('custom-slider')){
	customElements.define("custom-slider", CustomSlider);
}